---
title: Lectures 19 and 20
week: 9
lecture_date: 2022-11-28 and 2022-11-30
author: Ashwin Ranade
layout: lecture
parent: Lecture Notes
---

## Table of Contents
{: .no_toc }

{:toc}
- dummy item

## Concurrency
Concurrency is when we decompose a program into simultaneously executing tasks. 

The tasks can: 
- run in parallel on multiple cores, OR run multiplexed on a single core
- operate on independent data, OR operate on shared mutable data/systems
- be launched deterministcally through program flow, OR be lanuched to due external event (button click in UI)

Concurrency can make our programs more efficient!

**Question:** If a concurrent program only runs on a single core, why would it be any faster than a program that runs serially?
**Answer:** Some tasks involve lots of waiting, not a lot of CPU. During that waiting time, a concurrent program can use the CPU for other useful tasks!
- example: downloading a photo

### Concurrency Bugs

**Question:** What will the value of karma be if I run both functions concurrently until completion? Why?

```
int karma = 0;

void do_good_deeds() {
  for (int i=0;i<100000;++i)
    karma++;
}

void be_naughty() {
  for (int i=0;i<100000;++i)
    karma--;
}
```

**Answer:** Answer: Given that each "thread" of execution can be interrupted at any time to run the other, it's impossible to know!

The undefined behavior is due to both threads using a _shared mutable state_; `karma` is a mutable variable that's shared between multiple threads. 
(Race Condition)
- a key goal of concurrency is **determinism**; code should produce the same result every time, **regardless** of how its tasks are scheduled. 

### Concurrency With Shared Mutable State

Most modern languages now have built-in language features to make it safer to use shared mutable state.



















